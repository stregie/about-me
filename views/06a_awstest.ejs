<%# <html> %>
<%- include('00a_header.ejs') %>
    <link rel = "stylesheet" href = "/css/01_main.css">    
    <script src="https://sdk.amazonaws.com/js/aws-sdk-2.1249.0.min.js"></script>

    <div class="container">
      <h1>Aws bucket test</h1>
      <ul>
        <li><a href = "/fileuploader-s3/awstest/download">awstest/download</a></li>
        <!-- <li><a href = "/fileuploader-s3/awstest/download?file=item.txt">awstest/download?file=item.txt</a></li> -->
        <li><a href = "/fileuploader-s3/awstest/download?file=item.txt&path=about-me/aws-test/">awstest/download?file=item.txt&path=about-me/awstest</a></li>
        <li><a href = "/fileuploader-s3/awstest/download?file=item3.wtf&path=about-me/aws-test/">awstest/download?file=item3.wtf&path=about-me/awstest</a></li>
        <li><a href = "https://cyclic-bandicoot-garters-eu-central-1.s3.eu-central-1.amazonaws.com/about-me/aws-test/item.txt">hotlink</a></li>
        <li><a href = "https://s3.eu-central-1.amazonaws.com/cyclic-bandicoot-garters-eu-central-1/about-me/aws-test/item.txt">hotlink2</a></li>
        <li><a href = "/fileuploader-s3/awstest/upload/">Upload test</a></li>
        <li><a href = "/fileuploader-s3/awstest/filelist/">Get File list</a></li>
        <li><a href = "/fileuploader-s3/awstest/uploadStream?file=COPY_JenoSped.png">Upload with fs.createReadStream - COPY_Jeno Sped.png</a></li>
        <li><a href = "/fileuploader-s3/awstest/uploadStream?file=uploadthis268.txt">Upload with fs.createReadStream - uploadthis268.txt </a></li>
        <li><a href = "/fileuploader-s3/awstest/uploadStream?file=20211107_151125.jpg">Upload with fs.createReadStream - 20211107_151125.jpg </a></li>
      </ul>

      <h4>Upload from form</h4>
      <p>Description</p>
      <form name = "ex01form" enctype = "multipart/form-data">
        <input id = "ex01input" name = "ex01input" type = "file" multiple>
      </form>
      <button id = "ex01btn-a" class = "btn btn-default">Upload</button>
      <p>Upload info: <span id = "ex01res-a"></span></p>
      <p>Percentage: <span id = "ex01res-b"></span></p>
      <p>Server response: <span id = "ex01res-c"></span></p>

      <script>
        $(document).ready(function(){
          $('#ex01btn-a').click(ex01upload);
        });

        function ex01upload(){
          const formData = new FormData();
          const selectedFiles = document.querySelector('#ex01input').files;
          const resp = document.querySelector('#ex01res-a');
          const perc = document.querySelector('#ex01res-b');
          const serv = document.querySelector('#ex01res-c');

          if (selectedFiles.length <= 0){
            resp.textContent = "No files selected.";
            return;
          }

          for (let i = 0; i < selectedFiles.length; i++){
            formData.append('file', selectedFiles[i]);
          };

          let xhr = new XMLHttpRequest();
          xhr.open('POST', '/fileuploader-s3/upload2'); 
          xhr.send(formData);        

          xhr.onprogress = (e) => {
            let percentCompleted = Math.floor((e.loaded / e.total) * 100);
            perc.textContent = percentCompleted + "% completed";
          };
          
          xhr.onload = (e) => {
            if (xhr.status != 200) {
              resp.textContent = `Error ${xhr.status}: ${xhr.statusText}`;
            } else {
              resp.textContent = `Upload finished (${xhr.response.length}) bytes`;
              serv.textContent = xhr.response; 
            }
          };

          xhr.onerror = () => {
            resp.textContent = "Request failed";
          };
        };
      </script>

    </div>
    <script>

    </script>
<%- include('00b_footer.ejs') %>
<%# </html> %>